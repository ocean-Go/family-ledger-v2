# 🏠 Family Ledger V2 - 智能家庭账本

## 1. 设计需求

### 核心功能
当用户上传小票、收据、账单或文字说明时：
1. 识别提取关键信息（日期、商家、金额、类别、支付方式）
2. 判断【收入/支出】
3. 归类到家庭分类（餐饮、超市、交通、房租、水电、孩子、医疗、娱乐、其他）
4. 异常提醒或优化建议
5. 清晰表格输出

### 数据存储建议
- **原始图片**: Supabase Storage (`receipts/` bucket)
- **清洗后数据**: Supabase Database (`family_ledger_v2` table)

---

## 2. 技术架构

### 前端
- 纯 HTML/CSS/JS (单页应用)
- 拖拽上传 + 手动输入
- 移动端友好

### 后端
- Supabase Database + Storage
- AI 解析服务 (MiniMax API)

---

## 3. 数据库设计

### 表: `family_ledger_v2`
| 字段 | 类型 | 说明 |
|------|------|------|
| id | UUID | 主键 |
| 日期 | DATE | 交易日期 |
| 商家 | TEXT | 商家名称 |
| 金额_eur | NUMERIC | 金额(欧元) |
| 收支 | TEXT | 收入/支出 |
| 分类 | TEXT | 消费分类 |
| 支付方式 | TEXT | 支付渠道 |
| 备注 | TEXT | 备注/异常提醒 |
| 原始图片_url | TEXT | 图片链接(可选) |
| 创建时间 | TIMESTAMP | 创建时间 |

### Storage Bucket
- `receipts/` - 存储原始收据图片

---

## 4. 分类定义

### 支出分类
- 🍽️ 餐饮 (dining)
- 🛒 超市 (supermarket)
- 🚗 交通 (transport)
- 🏠 房租 (rent)
- 💡 水电 (utilities)
- 👶 孩子 (kids)
- 💊 医疗 (medical)
- 🎬 娱乐 (entertainment)
- 👕 服装 (clothing)
- 📱 通讯 (phone)
- 🔧 其他 (other)

### 收入分类
- 💰 工资 (salary)
- 💵 退款 (refund)
- 🎁 礼物 (gift)
- 📈 投资 (investment)
- 💼 其他收入 (other)

---

## 5. AI 解析 Prompt

```
你是一个家庭财务管理助手。请从以下内容中提取账目信息：

输入可能是：
- 小票/收据图片的描述
- 文字说明
- 账单信息

请提取并返回 JSON 格式：
{
  "日期": "YYYY-MM-DD",
  "商家": "商家名称",
  "金额_eur": 数字,
  "收支": "支出" | "收入",
  "分类": "分类名称",
  "支付方式": "支付方式",
  "备注": "异常提醒或优化建议(如果没有则为空)"
}

注意：
- 金额单位为欧元(€)
- 如果无法确定日期，使用今天日期
- 如果金额不明确，设为0并在备注中说明
- 检查是否有异常大额支出或重复消费
```

---

## 6. UI 布局

```
┌─────────────────────────────────────┐
│  🏠 家庭账本 V2                    │
│  智能识别 · 快速记账                │
├─────────────────────────────────────┤
│  ┌─────────────────────────────┐   │
│  │                             │   │
│  │   📷 点击或拖拽上传小票      │   │
│  │   支持图片或文字输入         │   │
│  │                             │   │
│  └─────────────────────────────┘   │
├─────────────────────────────────────┤
│  ┌─────────────────────────────┐   │
│  │ 或手动输入:                  │   │
│  │ [文本输入框]                 │   │
│  │ [解析按钮]                   │   │
│  └─────────────────────────────┘   │
├─────────────────────────────────────┤
│  📋 解析结果                        │
│  ┌─────────────────────────────┐   │
│  │ 日期   | 商家   | 金额 | 分类│   │
│  │ ----   | ----   | ---- | ----│   │
│  │ ...    | ...    | ...  | ... │   │
│  └─────────────────────────────┘   │
├─────────────────────────────────────┤
│  [保存到账本]  [重新解析]           │
├─────────────────────────────────────┤
│  📊 本月统计: €XXX (支出)          │
└─────────────────────────────────────┘
```
